

##############################################################################
# Title:   OpenLFConnect
# Author:  Jason Pruitt
# Email:   jrspruitt@gmail.com
# IRC:     #didj irc.freenode.org
# Wiki:    http://elinux.org/LeapFrog_Pollux_Platform:_OpenLFConnect
##############################################################################

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

1. Requirements
2. Installation
3. Issues

1. Requirements
	Operating System:
		Windows
		Linux

	Python:
		2.6

	Programs:
		LeapFrog USB LAN driver
			Search Windows Update when asked
			Install LFConnect, can then be uninstalled.
			
        Bonjour http://support.apple.com/kb/DL999
			Windows only
			Installs with LFConnect
			Will be left behind when LFConnect is uninstalled.
			Or download it, its free.

		sg3_utils
			Windows ports of sg_raw, sg_scan, sg_verify included
				for full set and licensing check http://sg.danny.cz/sg/sg3_utils.html
			Linux it's commonly installed




2. Installation
Download:

Archive	
	http://<ADD LATER>/OpenLFConnect.tar.gz

Git repo:
	git clone git@github.com:jrspruitt/OpenLFConnect.git

Operating System:
General
The program makes every attempt to figure out what it needs to know on its own. If you run into problems there are functions that should be able to let you manually configure around it. ex set_host_ip 169.254.0.1 then dftp_connect

Windows - General
	If you have LFConnect installed you may want to disable Monitor.exe in the Task Manager first. This will prevent LFConnect from opening when one of your devices is plugged in. Warning it will be started again on next reboot, or if LFConnect is opened. To permenantly disable it, look for this registry key and delete it, this example is from XP Pro.

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\Monitor


Windows - Explorer or LeapPad
    If you want the IP address to be discovered when the device boots up, you will need to install Bonjour. If you've configured your device to a static IP, you don't need to worry about it.
    Windows defaults to a 169.254. zeroconf subnet when it can't find a DHCP server, it takes about a minute and a half for it to do so on XP. If you want you can leave it this way, and it will be detected, the time out for getting the host IP is 2 minutes. Setting a static IP greatly speeds this up.
	Turn your device on and plug in the USB cable. You should see a network icon, attempting to connect, or look in your network devices for the new connection. You want to open up the properties, go to TCP/IP then properties, and change the settings from obtain IP from DHCP and instead use a static IP address.

Static IP 169.254.0.1
Netmask   255.255.0.0

You can use any IP you want that starts with 169.254 This is the zeroconfig subnet the devices will be on. The only time the host IP address will be needed, is when connecting to the device, a route will need to be set. OpenLFConnect normally searches for a network interface with an IP starting with 169.254. If you want something different than the example change the default in services/networking.py in the applications root directory. You can also prevent a host IP look up at all, but configuring the host IP there too.

self._subnet = '169.254.'
self._host_ip = '169.254.0.1'


Windows - Didj
	Plug your device in, and go to manage your computer. You want to find the disks section, there you will find a removable disk, with no media. You'll need to assign it a drive letter, as LFConnect mounts it in a different way. The drive letter does not matter, just one that is not conflicting with other devices. OpenLFConnect will go through the disks and find the right one.


Linux - General
	Make sure you have sg3_utils installed, as this program relies on them being available. There are some inherent permission issues with the device files that will need to be dealt with. The easiest way is to use a udev rule, which will give a common user access to the device, and set up a presistent device name. In OpenLFConnect/src/udev you will find the rules. There is one for USB Storage device and one for Ethernet. It is highly recommened you install the USB Storage rules as they will be used by all three devices and makes connecting to them much easier.

sudo cp OpenLFConnect/src/udev_rules/99-LeapFrog-Mass_Storage.rules /etc/udev/rules.d/
sudo chown root:root /etc/udev/rules.d/99-LeapFrog-Mass_Storage.rules
sudo chmod 644 /etc/udev/rules.d/99-LeapFrog-Mass_Storage.rules

Then with your device plugged in, Didj in normal mode, LeapPad and Explorer in USB Boot mode run this, where sg2 is your device, check dmesg if needed:

sudo udevadm test /sys/class/scsi_generic/sg2/

if you choose not to install the rules, you will need to run OpenLFConnect with sudo, it will search out the correct /dev/sg[x] device. This is not recommened, as OpenLFConnect as commands to delete files, if you forgot to double check if its set to remote or local, you could in advertently delete something important on your desktop machine.


Linux - Explorer LeapPad
	Plug in your device and turn it on, it will attempt a network connection. Open Network Connections and check to see if there is an entry such as "Auto eth1" that showed up after plug in. If there is, you'll want to open it up, and go to the ipv4 Settings section. Under Method set it to link local.
	If you do not have an "Auto eth1" that shows up, and you have avahi-autoipd installed, its common, you can use the Networking udev rule provided, this is essentially what Network Manager does when set to link local. It will pick a 169.254.x.x host address for you. OpenLFConnect will pick this up automatically for your reference, as the program itself has no use for it on Linux.
	You could also set up a static IP on the 169.254 subnet if you are concerned with having the same IP everytime for your host computer. For Linux OpenLFConnect does not care which IP the host has, and will get any IP the device is set to. So you could pick different ones if you have access to the device to configure its IP. In system/networking.py configure these.

self._subnet = '169.254.'
self._host_ip = '169.254.0.1'



3. Issues:
Windows - OpenLFConnect
	Autocomplete does not work in the command prompt window.
	The Didj serial number is not returned, will always be Unknown.

Linux - Didj
	didj_eject and didj_lock, will not work once the drive has been mounted, you will need to manually unmount or eject the drive. The eject command will still be sent to the device, but nothing will happen until Linux unmounts it.










